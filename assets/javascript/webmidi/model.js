// Generated by CoffeeScript 1.10.0
(function() {
  this.MidiTrack = (function() {
    MidiTrack.prototype.RecordState = {
      Initialized: 'Initialized',
      Recording: 'Recording',
      Stopped: 'Stopped'
    };

    MidiTrack.Vars = {
      LowestNoteValue: 21,
      HighestNoteValue: 108
    };

    function MidiTrack(name, timeSignatureBeats, timeSignatureBar, bpm, options) {
      var i, index, ref, ref1;
      if (options == null) {
        options = {};
      }
      this.name = name != null ? name : 'Unnamed Track';
      this.state = MidiTrack.prototype.RecordState.Initialized;
      this.timeSignatureBeats = timeSignatureBeats != null ? timeSignatureBeats : -1;
      this.timeSignatureBar = timeSignatureBar != null ? timeSignatureBar : -1;
      this.start = -1;
      this.end = -1;
      this.duration = -1;
      this.bpm = bpm;
      this.canRecord = true;
      this.options = options;
      this.notes = {};
      this.noteEventMap = {};
      this.noteEventList = [];
      this.orderedTimestampList = [];
      for (index = i = ref = MidiTrack.Vars.LowestNoteValue, ref1 = MidiTrack.Vars.HighestNoteValue; ref <= ref1 ? i <= ref1 : i >= ref1; index = ref <= ref1 ? ++i : --i) {
        this.noteEventList.push([]);
      }
    }

    MidiTrack.prototype.startRecording = function() {
      if (!this.canRecord) {
        throw 'Cannot begin recording MIDI track because it has already been recorded.';
      }
      this.state = MidiTrack.prototype.RecordState.Recording;
      return this.start = window.performance.timing.navigationStart + window.performance.now();
    };

    MidiTrack.prototype.stopRecording = function() {
      this.canRecord = false;
      this.end = window.performance.timing.navigationStart + window.performance.now();
      this.duration = this.end - this.start;
      return this.state = MidiTrack.prototype.RecordState.Stopped;
    };

    MidiTrack.prototype.recordEvent = function(midiIoEvent) {
      var noteOffEvent, noteOnEvent;
      if (midiIoEvent.type === MidiIo.EventType.NoteOn) {
        this.noteEventList[midiIoEvent.value].push(midiIoEvent);
        this.noteEventMap[midiIoEvent.occurred] = midiIoEvent;
        return this.orderedTimestampList.push(midiIoEvent.occurred);
      } else if (midiIoEvent.type === MidiIo.EventType.NoteOff) {
        noteOnEvent = this.noteEventList[midiIoEvent.value].pop();
        noteOffEvent = midiIoEvent;
        return this.notes[noteOnEvent.occurred] = new MidiNote(noteOnEvent.value, noteOnEvent.note, noteOnEvent.octave, noteOnEvent.velocity, noteOnEvent.occurred, noteOffEvent.occurred - noteOnEvent.occurred);
      }
    };

    MidiTrack.prototype.save = function() {
      return JSON.stringify(this);
    };

    MidiTrack.restore = function(jsonString) {
      return JSON.parse(jsonString);
    };

    return MidiTrack;

  })();

  this.MidiNote = (function() {
    function MidiNote(value, note, octave, velocity, occurred, duration) {
      this.value = value != null ? value : -1;
      this.note = note != null ? note : '';
      this.octave = octave != null ? octave : -1;
      this.velocity = velocity != null ? velocity : -1;
      this.occurred = occurred;
      this.duration = duration;
    }

    MidiNote.prototype.toString = function() {
      return "" + this.note + this.octave + " [" + this.velocity + "] @ " + duration + " ms";
    };

    return MidiNote;

  })();

  this.MidiChord = (function() {
    function MidiChord(notes) {
      this.notes = notes;
    }

    return MidiChord;

  })();

}).call(this);

//# sourceMappingURL=model.js.map
